<launch>
    <!-- Path Variables -->
    <let name="urdf_path" 
         value="$(find-pkg-share my_robot_bringup)/urdf/SimAssemb.urdf.xacro" />
    <let name="gazebo_config_path" 
         value="$(find-pkg-share my_robot_bringup)/config/gazebo_bridge.yaml" />
    <let name="controllers_config_path"
         value="$(find-pkg-share my_robot_bringup)/config/ros2_controller.yaml" />
    
    <!-- Robot State Publisher -->
    <node pkg="robot_state_publisher" exec="robot_state_publisher" output="screen">
        <param name="robot_description" value="$(command 'xacro $(var urdf_path)')"/>
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Set Gazebo resource path -->
    <set_env name="GZ_SIM_RESOURCE_PATH" value="$(find-pkg-prefix my_robot_bringup)/share"/>
    
    <!-- Launch Gazebo -->
    <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
        <arg name="gz_args" value="empty.sdf -r"/>
    </include>
    
    <!-- Spawn Robot -->
    <node pkg="ros_gz_sim" exec="create" output="screen"
          args="-topic robot_description -name my_robot -z 0.2"/>
    
    <!-- ROS-Gazebo Bridge -->
    <node pkg="ros_gz_bridge" exec="parameter_bridge" output="screen">
        <param name="config_file" value="$(var gazebo_config_path)"/>
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Controller Spawners -->
    <!-- Joint State Broadcaster -->
    <node pkg="controller_manager" exec="spawner" output="screen"
          args="joint_state_broadcaster --controller-manager /controller_manager">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Joint Position Controller -->
    <node pkg="controller_manager" exec="spawner" output="screen"
          args="joint_position_controller --controller-manager /controller_manager">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- RViz -->
    <node pkg="rviz2" exec="rviz2" output="screen"
          args="-d /home/rushil/quadruped_ws/src/urdf_config.rviz">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- ========== MOTION CONTROL NODES ========== -->
    
    <!-- Forward Walk Node -->
    <node pkg="walk_pkg" exec="forward_walk" output="screen">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Backward Walk Node -->
    <node pkg="walk_pkg" exec="backward_walk" output="screen">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Idle/Default Position Node -->
    <node pkg="walk_pkg" exec="idle" output="screen">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Jump Node -->
    <node pkg="walk_pkg" exec="jump" output="screen">
        <param name="use_sim_time" value="true"/>
    </node>
    
    <!-- Robot Control (CLI) - Separate Terminal Window -->
    <node pkg="walk_pkg" exec="robot_control" output="screen"
          launch-prefix="gnome-terminal --title='Robot Control CLI' -- ">
        <param name="use_sim_time" value="true"/>
    </node>
    
</launch>